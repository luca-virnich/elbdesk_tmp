server {
    listen 80;
    server_name packages.*;

    client_max_body_size 1G;
    client_body_temp_path /tmp;  # Use /tmp instead of a subdirectory

    root /usr/share/nginx/html;

    location = /latest.json {
        add_header Cache-Control no-cache;
        add_header Content-Type application/json;
    }

    location ~ \.msix$ {
        add_header Cache-Control no-cache;
        add_header Content-Type application/msix;
        add_header Content-Disposition attachment;
    }

    # Main upload/WebDAV location
    location / {
        autoindex on;
        autoindex_exact_size off;
        autoindex_localtime on;

        # WebDAV configuration
        dav_methods PUT DELETE MKCOL COPY MOVE;
        create_full_put_path on;
        dav_access user:rw group:rw all:r;

        # Limit methods except GET
        limit_except GET {
            # Only allow authenticated users
            auth_basic "Restricted";
            auth_basic_user_file /etc/nginx/.htpasswd;
            allow all;
        }
    }
}